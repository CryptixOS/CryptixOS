packages:
  - name: bash
    architecture: '@OPTION:arch@'
    metadata:
      summary: The standard GNU Bourne again shell
      description: This package provides the Bourne-Again SHell.
      spdx: 'GPL-3.0-or-later'
      website: 'https://tiswww.case.edu/php/chet/bash/bashtop.html'
      maintainer: "Dennis Bonke <dennis@managarm.org>"
      categories: ['app-shells']
    source:
      subdir: 'sources'
      git: 'https://git.savannah.gnu.org/git/bash.git'
      # Checkout bash 5.1 patch 16
      branch: 'master'
      commit: '9439ce094c9aa7557a9d53ac7b412a23aa66e36b'
      version: '5.1.16'
      tools_required:
        - host-autoconf-v2.69
        - host-automake-v1.15
      regenerate:
        # While we do not need to regenerate the configure script, we need to touch it
        # after patching config.sub so that make does not try to regenerate it.
        - args: ['autoconf']
    tools_required:
      - host-autoconf-v2.69
      - host-automake-v1.15
      - system-gcc
    pkgs_required:
      - mlibc
      - ncurses
      - readline
      #- libiconv
    revision: 12
    configure:
      - args:
        - '@THIS_SOURCE_DIR@/configure'
        - '--host=@OPTION:arch-triple@'
        - '--prefix=/usr'
        - '--without-bash-malloc'
        - '--disable-nls'
        - '--disable-readline'
        - '--with-curses'
        #- '--with-installed-readline=$SYSROOT_DIR$/usr'
        environ:
          ac_cv_func_wcswidth: 'no'
    build:
      - args: ['make', '-j@PARALLELISM@']
      - args: ['make', 'DESTDIR=@THIS_COLLECT_DIR@', 'install']
        quiet: true
      - args: ['mkdir', '-p', '@THIS_COLLECT_DIR@/root/']
      - args: ['mkdir', '-p', '@THIS_COLLECT_DIR@/home/cryptix/']
      - args: ['mkdir', '-p', '@THIS_COLLECT_DIR@/etc/']
      - args: ['ln', '-sf', 'bash', '@THIS_COLLECT_DIR@/usr/bin/sh']

  - name: coretools
    architecture: '@OPTION:arch@'
    source:
      subdir: 'sources'
      version: '1.0'
    tools_required:
      - system-gcc
    pkgs_required:
      - base-files
      - mlibc
    configure: []
    build:
      - args: ['@OPTION:arch-triple@-g++', '-z', 'noexecstack', '@SOURCE_ROOT@/Userland/CoreTools/reboot.cpp',  '-o', '@SYSROOT_DIR@/usr/sbin/reboot']

  - name: coreutils
    architecture: '@OPTION:arch@'
    source:
      subdir: 'sources'
      git: 'https://git.savannah.gnu.org/git/coreutils.git'
      tag: 'v9.1'
      version: '9.1'
      tools_required:
        - host-automake-v1.15
        - host-autoconf-v2.69
      regenerate:
        - args: ['./bootstrap']
        - args: ['cp',
            '@BUILD_ROOT@/tools/host-automake-v1.15/share/automake-1.15/config.sub',
            '@THIS_SOURCE_DIR@/build-aux/']
    tools_required:
      - system-gcc
      - host-automake-v1.15
    pkgs_required:
      - mlibc
    configure:
      # Huge hack: coreutils does not compile the build-machine binary make-prime-list
      # using the build-machine compiler. Hence, build and invoke the binary manually here.
      - args:
        - '@THIS_SOURCE_DIR@/configure'
        environ: 
          ac_cv_sys_largefile_opts: 'none needed'
          ac_cv_sys_year2038_opts: 'none needed'
      - args: ['make', 'src/make-prime-list']
      - args: |
          ./src/make-prime-list 5000 > @THIS_SOURCE_DIR@/src/primes.h
      - args: ['make', 'clean']
      # Now compile coreutils for the correct target.
      - args:
        - '@THIS_SOURCE_DIR@/configure'
        - '--host=@OPTION:arch-triple@'
        - '--prefix=/usr'
        - '--disable-nls'
        - 'CFLAGS=-DSLOW_BUT_NO_HACKS -Wno-error'
    build:
      - args: ['make', '-j@PARALLELISM@']
      - args: ['make', 'install']
        environ:
          DESTDIR: '@THIS_COLLECT_DIR@'
        quiet: true

  - name: dash
    architecture: '@OPTION:arch@'
    metadata:
      summary: Debian Almquist SHell
      description: This package provides the Debian Almquist SHell, the default shell on debian.
      spdx: 'BSD'
      website: 'http://gondor.apana.org.au/~herbert/dash/'
      maintainer: "Dennis Bonke <dennis@managarm.org>"
    source:
      subdir: 'sources'
      git: 'https://git.kernel.org/pub/scm/utils/dash/dash.git'
      tag: 'v0.5.12'
      version: '0.5.12'
      tools_required:
        - host-autoconf-v2.69
        - host-automake-v1.15
      regenerate:
        - args: ['./autogen.sh']
    tools_required:
      - system-gcc
    pkgs_required:
      - mlibc
    revision: 1
    configure:
      - args:
        - '@THIS_SOURCE_DIR@/configure'
        - '--host=@OPTION:arch-triple@'
        - '--prefix=/usr'
        - '--enable-fnmatch'
    build:
      - args: ['make', '-j@PARALLELISM@']
      - args: ['make', 'install']
        environ:
          DESTDIR: '@THIS_COLLECT_DIR@'

  - name: file
    architecture: '@OPTION:arch@'
    from_source: file
    tools_required:
      - system-gcc
      - host-file
    pkgs_required:
      - mlibc
      - zlib
    configure:
      - args:
        - '@THIS_SOURCE_DIR@/configure'
        - '--host=@OPTION:arch-triple@'
        - '--prefix=/usr'
        - '--disable-bzlib'
        - '--disable-xzlib'
    build:
      - args: ['make', '-j@PARALLELISM@']
      - args: ['make', 'install']
        environ:
          DESTDIR: '@THIS_COLLECT_DIR@'

  - name: init
    architecture: '@OPTION:arch@'
    source:
      subdir: 'sources'
      version: '1.0'
    tools_required:
      - system-gcc
    pkgs_required:
      - base-files
      - mlibc
    configure: []
    build:
      - args: ['mkdir', '-p', '@THIS_COLLECT_DIR@/usr/sbin']
      - args: ['mkdir', '-p', '@THIS_COLLECT_DIR@/root']
      - args: ['@OPTION:arch-triple@-g++', '-z', 'noexecstack', '@SOURCE_ROOT@/Userland/Init/init.cpp',  '-o', '@THIS_COLLECT_DIR@/usr/sbin/init']
      #- args: ['@OPTION:arch-triple@-gcc', '-z', 'noexecstack', '@SOURCE_ROOT@/Userland/Init/reboot.c', '-o', '@THIS_COLLECT_DIR@/usr/sbin/reboot']
      
  - name: less
    architecture: '@OPTION:arch@'
    metadata:
      summary: Excellent text file viewer
      description: This package contains a text file viewer.
      spdx: 'GPL-3-only BSD-2-Clause'
      website: 'https://www.greenwoodsoftware.com/less/'
      maintainer: "Dennis Bonke <dennis@managarm.org>"
      categories: ['sys-apps']
    source:
      subdir: sources
      url: 'http://www.greenwoodsoftware.com/less/less-668.tar.gz'
      format: 'tar.gz'
      checksum: blake2b:0f6a85a1c66577dd2a28682a6f8399e42fdbe9fc1498b2e89c6bb7c47109e8d3ab934abe5dd998b2c8dfacfb174ad9daeb79b3d4c13df22fa035ea792b2eaf5e
      extract_path: 'less-668'
      version: '668'
    tools_required:
      - system-gcc
    pkgs_required:
      - mlibc
      - ncurses
    revision: 1
    configure:
      - args:
        - '@THIS_SOURCE_DIR@/configure'
        - '--host=@OPTION:arch-triple@'
        - '--prefix=/usr'
        - '--sysconfdir=/etc'
    build:
      - args: ['make', '-j@PARALLELISM@']
      - args: ['make', 'DESTDIR=@THIS_COLLECT_DIR@', 'install']

  - name: mini-lspci
    architecture: '@OPTION:arch@'
    metadata:
      summary: Small lspci program
      description: Small program for displaying PCI information.
      spdx: 'Zlib'
      website: 'https://github.com/qookei/mini-lspci'
      maintainer: 'Kacper Słomiński <qookie@managarm.org>'
      categories: ['sys-apps']
    source:
      subdir: 'sources'
      url: 'https://github.com/qookei/mini-lspci/releases/download/v1.2.2/mini-lspci-1.2.2.tar.xz'
      format: 'tar.xz'
      extract_path: 'mini-lspci-1.2.2'
      checksum: blake2b:c16690a6b12c2297f3c2aca3f9b9d80b4fad73d6ba3ba3220b508f949788119ff60b753218b2b53dfff04bb0c88054c6f8f28d4a04fc4714d360fa66189f15e2
      version: '1.2.2'
    tools_required:
      - system-gcc
    pkgs_required:
      - mlibc
      - pciids
    revision: 6
    configure:
      - args:
        - 'meson'
        - 'setup'
        - '--cross-file'
        - '@SOURCE_ROOT@/CrossFiles/target-@OPTION:arch-triple@.cross-file'
        - '--prefix=/usr'
        - '--buildtype=release'
        - '@THIS_SOURCE_DIR@'
    build:
      - args: ['ninja']
      - args: ['ninja', 'install']
        environ:
          DESTDIR: '@THIS_COLLECT_DIR@'
        quiet: true
      
  - name: neofetch
    architecture: noarch
    source:
      subdir: sources
      git: 'https://github.com/64/neofetch.git'
      branch: 'master'
      commit: 'd27a0bd748310d8ace673a614f745303b444e00e'
      version: '7.2.0'
    revision: 8
    configure:
      - args: ['cp', '-r', '@THIS_SOURCE_DIR@/.', '@THIS_BUILD_DIR@']
    build:
      - args: ['make', 'install']
        environ:
          DESTDIR: '@THIS_COLLECT_DIR@'

  - name: procps
    architecture: '@OPTION:arch@'
    metadata:
      summary: Standard informational utilities and process-handling tools
      description: The Procps-ng package contains programs for monitoring processes.
      spdx: 'GPL-2.0-or-later LGPL-2.0-or-later LGPL-2.1-or-later'
      website: 'https://gitlab.com/procps-ng/procps'
      maintainer: "Dennis Bonke <dennis@managarm.org>"
      categories: ['sys-process']
    source:
      subdir: sources
      git: 'https://gitlab.com/procps-ng/procps.git'
      tag: 'v4.0.4'
      version: '4.0.4'
      tools_required:
        - host-autoconf-v2.69
        - host-automake-v1.15
        - host-libtool
        - host-pkg-config
      regenerate:
        - args: ['./autogen.sh']
    tools_required:
      - system-gcc
      - virtual: pkgconfig-for-target
        triple: "@OPTION:arch-triple@"
    pkgs_required:
      - mlibc
      - ncurses
    configure:
      - args:
        - '@THIS_SOURCE_DIR@/configure'
        - '--host=@OPTION:arch-triple@'
        - '--prefix=/usr'
        - '--disable-static'
        - '--disable-kill'
        - '--docdir=/usr/share/doc/procps-ng-4.0.4'
        - '--disable-numa'
        - '--enable-colorwatch'
        - '--disable-nls'
        - '--disable-w'
        environ:
          ac_cv_func_malloc_0_nonnull: 'yes'
          ac_cv_func_realloc_0_nonnull: 'yes'
    build:
      - args: ['make', '-j@PARALLELISM@']
      - args: ['make', 'install']
        environ:
          DESTDIR: '@THIS_COLLECT_DIR@'
